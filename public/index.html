<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Idea Refiner</title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VJ225P5PY2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-VJ225P5PY2');
    </script>

    <meta name="google-adsense-account" content="ca-pub-6985276543491890">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6985276543491890"
        crossorigin="anonymous"></script>

    <meta name="description" id="meta-desc" content="Analyze your startup ideas instantly with AI.">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/8637/8637103.png" type="image/png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- Chart.js for Analysis Enhancement #4 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <link rel="stylesheet" href="style.css">
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { primary: '#2563eb', darkBg: '#0f172a', cardDark: '#1e293b' } } } }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
        }

        .prose h1 {
            color: #60a5fa;
            font-size: 1.4em;
            font-weight: 800;
            margin-top: 1em;
            border-bottom: 1px solid #374151;
            padding-bottom: 5px;
        }

        .prose h2 {
            color: #93c5fd;
            font-size: 1.2em;
            font-weight: 700;
            margin-top: 1em;
        }

        .prose ul {
            list-style-type: disc;
            padding-left: 1.2rem;
            color: #d1d5db;
        }

        .prose p {
            margin-bottom: 0.8rem;
            color: #e5e7eb;
        }

        .spinner {
            border-top-color: transparent;
            animation: spinner 1s linear infinite;
        }

        @keyframes spinner {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #pdf-generator-container {
            position: fixed;
            top: -10000px;
            left: -10000px;
            width: 800px;
            background: white;
            color: black;
            padding: 40px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 min-h-screen flex flex-col">

    <div id="pdf-generator-container"></div>

    <div id="loading-screen" class="hidden fixed inset-0 bg-black/80 z-[9999] flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl max-w-md w-full mx-4 shadow-2xl">
            <div class="text-center mb-4">
                <div class="text-5xl mb-3" id="loading-emoji">üîç</div>
                <h3 class="font-bold text-xl mb-2" id="loading-title">Analyzing...</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400" id="loading-message">Gathering market data</p>
            </div>

            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-4 overflow-hidden">
                <div id="progress-bar"
                    class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500"
                    style="width: 0%"></div>
            </div>

            <p class="text-xs text-gray-400 text-center" id="loading-sub">‚è±Ô∏è Average time: 15-20 seconds</p>
        </div>
    </div>

    <div id="cookie-banner"
        class="fixed bottom-0 left-0 w-full bg-gray-900 border-t border-gray-700 p-4 shadow-2xl z-[9999] hidden transform transition-transform duration-500 translate-y-full">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="text-sm text-gray-300 text-center md:text-left">
                <i class="fas fa-cookie-bite text-yellow-500 mr-2"></i>
                <span id="cookie-text">We use cookies to provide a better experience.</span>
            </div>
            <div class="flex gap-3">
                <button onclick="rejectCookies()" id="cookie-reject-btn"
                    class="text-gray-400 hover:text-white px-4 py-2 rounded-lg text-sm font-medium transition border border-gray-600 hover:border-gray-400">Reject</button>
                <button onclick="acceptCookies()" id="cookie-accept-btn"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-sm font-bold transition shadow-lg">Accept</button>
            </div>
        </div>
    </div>

    <div id="feedback-modal"
        class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md border border-gray-200 dark:border-gray-700 relative overflow-hidden transform transition-all scale-95 opacity-0"
            id="feedback-content">
            <div class="bg-blue-600 p-4 text-white flex justify-between items-center">
                <h3 class="font-bold text-lg"><i class="far fa-paper-plane mr-2"></i> <span id="fb-title">Feedback &
                        Contact</span></h3>
                <button onclick="toggleFeedback()" class="hover:bg-blue-700 p-1 rounded"><i
                        class="fas fa-times"></i></button>
            </div>

            <form action="https://formspree.io/f/mqarbyej" method="POST" class="p-6 space-y-4">
                <div>
                    <label class="block text-xs font-medium text-gray-500 mb-1" id="fb-email-label">Email
                        (Optional)</label>
                    <input type="email" name="email"
                        class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                        placeholder="example@email.com">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-500 mb-1" id="fb-msg-label">Message</label>
                    <textarea name="message" id="fb-msg-input" rows="4"
                        class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-none"
                        placeholder="What's on your mind?" required></textarea>
                </div>
                <button type="submit" id="fb-submit-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition active:scale-95">Send
                    üöÄ</button>
            </form>
        </div>
    </div>



    <!-- Comparison Modal (Analysis Enhancement #7) -->
    <div id="compare-modal"
        class="hidden fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
        <div
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl border border-gray-200 dark:border-gray-700 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="compare-title" class="font-bold text-2xl dark:text-white">‚öñÔ∏è Fikir Kar≈üƒ±la≈ütƒ±rmasƒ±</h3>
                    <button onclick="closeCompareModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Input Section -->
                <div id="compare-input-section">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label id="compare-label-a" class="block text-sm font-semibold mb-2 dark:text-white">Fikir
                                A</label>
                            <textarea id="compare-idea-a" rows="4"
                                class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:text-white dark:border-gray-600"
                                placeholder="ƒ∞lk fikrinizi yazƒ±n..."></textarea>
                        </div>
                        <div>
                            <label id="compare-label-b" class="block text-sm font-semibold mb-2 dark:text-white">Fikir
                                B</label>
                            <textarea id="compare-idea-b" rows="4"
                                class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:text-white dark:border-gray-600"
                                placeholder="ƒ∞kinci fikrinizi yazƒ±n..."></textarea>
                        </div>
                    </div>
                    <button id="compare-btn"
                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 rounded-lg">
                        üîÑ Kar≈üƒ±la≈ütƒ±r
                    </button>
                </div>

                <!-- Results Section -->
                <div id="compare-results-section" class="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <!-- Idea A Results -->
                        <div id="result-a"
                            class="bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-500 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-bold text-lg dark:text-white" id="name-a">Fikir A</h4>
                                <div class="text-3xl font-bold text-blue-600" id="score-a">7.5</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm font-semibold text-green-600 dark:text-green-400 mb-1"><span
                                        class="comp-pros-title">‚úÖ Artƒ±lar:</span></div>
                                <ul id="pros-a" class="text-xs space-y-1 list-disc list-inside dark:text-gray-300"></ul>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-red-600 dark:text-red-400 mb-1"><span
                                        class="comp-cons-title">‚ùå Eksiler:</span></div>
                                <ul id="cons-a" class="text-xs space-y-1 list-disc list-inside dark:text-gray-300"></ul>
                            </div>
                        </div>

                        <!-- Idea B Results -->
                        <div id="result-b"
                            class="bg-gray-50 dark:bg-gray-700/50 border-2 border-gray-300 dark:border-gray-600 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-bold text-lg dark:text-white" id="name-b">Fikir B</h4>
                                <div class="text-3xl font-bold text-gray-600 dark:text-gray-400" id="score-b">6.8</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-sm font-semibold text-green-600 dark:text-green-400 mb-1"><span
                                        class="comp-pros-title">‚úÖ Artƒ±lar:</span></div>
                                <ul id="pros-b" class="text-xs space-y-1 list-disc list-inside dark:text-gray-300"></ul>
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-red-600 dark:text-red-400 mb-1"><span
                                        class="comp-cons-title">‚ùå Eksiler:</span></div>
                                <ul id="cons-b" class="text-xs space-y-1 list-disc list-inside dark:text-gray-300"></ul>
                            </div>
                        </div>
                    </div>

                    <!-- Recommendation -->
                    <div
                        class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border-2 border-yellow-400 rounded-xl p-4">
                        <div class="flex items-start gap-3">
                            <div class="text-4xl">üèÜ</div>
                            <div>
                                <h4 id="ai-rec-title" class="font-bold text-lg mb-2 dark:text-white">AI Tavsiyesi</h4>
                                <p id="recommendation" class="text-sm dark:text-gray-300"></p>
                            </div>
                        </div>
                    </div>

                    <button onclick="resetComparison()" id="new-compare-btn"
                        class="w-full mt-4 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white font-semibold py-2 rounded-lg">
                        Yeni Kar≈üƒ±la≈ütƒ±rma
                    </button>
                </div>
            </div>
        </div>
    </div>

    <nav
        class="w-full bg-white/95 dark:bg-gray-900/95 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200 dark:border-gray-800">
        <div class="max-w-7xl mx-auto px-3 py-2 md:px-4 md:py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <img src="images/logo.png" onerror="this.src='https://cdn-icons-png.flaticon.com/512/8637/8637103.png'"
                    class="h-7 w-7 md:h-8 md:w-8 rounded-full shadow-lg bg-white p-0.5">
                <span
                    class="text-base md:text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-purple-600">
                    AI Idea Refiner
                </span>
            </div>
            <div class="flex items-center gap-1 md:gap-4">
                <a href="blog.html"
                    class="hidden md:inline-block text-sm md:text-base hover:text-blue-400 transition">üìù Blog</a>
                <button onclick="openCompareModal()" id="nav-compare"
                    class="hidden md:inline-block text-sm md:text-base hover:text-blue-400 transition">‚öñÔ∏è
                    Compare</button>
                <button onclick="toggleFeedback()" id="nav-fb-text"
                    class="hidden md:inline-block text-sm md:text-base hover:text-blue-400 transition">üí¨
                    Feedback</button>
                <div class="hidden md:block h-4 w-[1px] bg-gray-300 dark:bg-gray-700"></div>

                <select id="lang-select"
                    class="bg-gray-100 dark:bg-gray-800 border-none rounded-lg px-2 py-1 text-xs font-medium focus:ring-0">
                    <option value="en" selected>EN</option>
                    <option value="tr">TR</option>
                </select>

                <button id="theme-toggle"
                    class="w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center"><i
                        class="fas fa-moon text-sm" id="theme-icon"></i></button>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" onclick="toggleMobileMenu()"
                    class="md:hidden w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
                    <i class="fas fa-bars text-sm"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu"
            class="hidden md:hidden bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 px-4 py-3 space-y-2">
            <a href="blog.html" class="block py-2 text-sm hover:text-blue-400 transition">üìù Blog</a>
            <button onclick="openCompareModal(); toggleMobileMenu();"
                class="block w-full text-left py-2 text-sm hover:text-blue-400 transition">‚öñÔ∏è Compare</button>
            <button onclick="toggleFeedback(); toggleMobileMenu();"
                class="block w-full text-left py-2 text-sm hover:text-blue-400 transition">üí¨ Feedback</button>
        </div>
    </nav>

    <div class="flex flex-col md:flex-row max-w-7xl mx-auto w-full p-4 gap-6 flex-grow">
        <aside class="w-full md:w-1/4 hidden md:block">
            <div
                class="bg-white dark:bg-gray-800 rounded-xl shadow border border-gray-200 dark:border-gray-700 p-4 sticky top-20 max-h-[80vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-4 border-b border-gray-200 dark:border-gray-700 pb-2">
                    <h3 id="history-title" class="font-bold text-xs text-gray-500">HISTORY</h3>
                    <button onclick="clearAllHistory()" id="history-clear-btn"
                        class="text-xs text-red-400 hover:text-red-600">Clear</button>
                </div>
                <div id="history-list" class="space-y-2"></div>
            </div>
        </aside>

        <main class="w-full md:w-3/4 flex flex-col gap-4 md:gap-6">
            <div class="text-center space-y-3 md:space-y-4 mt-1 md:mt-2 px-2 md:px-0">
                <h1 id="hero-title"
                    class="text-2xl sm:text-3xl md:text-5xl lg:text-6xl font-extrabold tracking-tight leading-tight">
                    Analyze Your <span class="text-blue-500">Startup Idea</span> in 60 Seconds
                </h1>
                <div
                    class="flex flex-wrap gap-2 md:gap-6 justify-center text-[10px] sm:text-xs md:text-sm text-gray-600 dark:text-gray-300">
                    <span
                        class="flex items-center gap-1 md:gap-2 bg-green-50 dark:bg-green-900/20 px-2 py-1 md:px-3 md:py-1.5 rounded-full">
                        <span class="text-green-600 dark:text-green-400">‚úÖ</span> <span id="feat-1">Market
                            Analysis</span>
                    </span>
                    <span
                        class="flex items-center gap-1 md:gap-2 bg-blue-50 dark:bg-blue-900/20 px-2 py-1 md:px-3 md:py-1.5 rounded-full">
                        <span class="text-blue-600 dark:text-blue-400">‚úÖ</span> <span id="feat-2">Competitor
                            Analysis</span>
                    </span>
                    <span
                        class="flex items-center gap-1 md:gap-2 bg-purple-50 dark:bg-purple-900/20 px-2 py-1 md:px-3 md:py-1.5 rounded-full">
                        <span class="text-purple-600 dark:text-purple-400">‚úÖ</span> <span id="feat-3">Cost
                            Estimation</span>
                    </span>
                </div>
                <div class="mt-4 md:mt-6 flex gap-2 md:gap-3 justify-center flex-wrap">
                    <button onclick="scrollToInput()" id="hero-analyze-btn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 md:py-3 md:px-8 rounded-lg shadow-lg transition active:scale-95 text-sm md:text-base">
                        ANALYZE FOR FREE
                    </button>
                    <button onclick="showExampleReport()" id="hero-example-btn"
                        class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 md:py-3 md:px-8 rounded-lg shadow-lg transition active:scale-95 text-sm md:text-base">
                        SEE EXAMPLE REPORT
                    </button>
                </div>
            </div>



            <div
                class="ad-space w-full h-24 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center border border-gray-200 dark:border-gray-700 text-gray-400 text-xs overflow-hidden">
                <script async
                    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6985276543491890"
                    crossorigin="anonymous"></script>
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6985276543491890"
                    data-ad-slot="auto" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>

            <div class="bg-white dark:bg-gray-800 p-2 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <textarea id="idea-input"
                    class="w-full h-40 p-4 bg-transparent text-base focus:outline-none resize-none rounded-lg"
                    placeholder="Type your idea here..."></textarea>

                <!-- Idea Quality Feedback (Analysis Enhancement #2) -->
                <div id="quality-feedback" class="px-2 pb-2 hidden">
                    <div
                        class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 mb-2">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span id="quality-title-label"
                                    class="text-sm font-semibold text-gray-700 dark:text-gray-300">Idea
                                    Quality:</span>
                                <div class="flex gap-1" id="quality-stars">
                                    <span class="text-yellow-500">‚≠ê</span>
                                    <span class="text-yellow-500">‚≠ê</span>
                                    <span class="text-gray-300">‚≠ê</span>
                                    <span class="text-gray-300">‚≠ê</span>
                                    <span class="text-gray-300">‚≠ê</span>
                                </div>
                            </div>
                            <span class="text-xs text-gray-500 dark:text-gray-400" id="word-count">0 words</span>
                        </div>
                        <div id="quality-suggestions" class="text-xs space-y-1">
                            <!-- Suggestions will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center px-2 pb-2">
                    <span class="text-[10px] text-gray-400"><i class="fas fa-bolt"></i> Powered by Groq</span>
                    <button id="analyze-btn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-6 rounded-lg shadow-lg flex items-center gap-2 transition active:scale-95">
                        <span id="btn-text">Analyze</span>
                        <div id="loading-spinner"
                            class="w-4 h-4 border-2 border-white border-t-transparent rounded-full spinner hidden">
                        </div>
                    </button>
                </div>
            </div>

            <div id="result-area" class="hidden opacity-0 transition-all duration-500">
                <div class="bg-gray-900 text-white rounded-xl shadow-lg overflow-hidden border border-gray-700">
                    <div class="p-6 md:p-10 bg-gray-900">
                        <div class="flex items-center gap-3 border-b border-gray-700 pb-4 mb-4">
                            <img src="images/logo.png"
                                onerror="this.src='https://cdn-icons-png.flaticon.com/512/8637/8637103.png'"
                                class="h-8 w-8 bg-white rounded-full p-0.5">
                            <h2 id="report-title" class="text-xl font-bold">Analysis Report</h2>
                        </div>

                        <!-- Score Breakdown Card (Analysis Enhancement #1) -->
                        <div id="score-card"
                            class="hidden mb-6 bg-gradient-to-r from-blue-900 to-purple-900 rounded-xl p-6 border border-blue-700">
                            <div class="text-center mb-4">
                                <div class="text-6xl font-bold text-white mb-2" id="overall-score">7.5</div>
                                <div class="text-sm text-gray-300" id="overall-score-title">Overall Score (out of 10)
                                </div>
                                <div class="mt-2">
                                    <span id="risk-badge"
                                        class="px-3 py-1 rounded-full text-xs font-bold bg-yellow-500 text-black">Medium
                                        Risk</span>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-4">
                                <!-- Market Size -->
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-white" id="score-market-label">üìä Market
                                            Size</span>
                                        <span class="text-sm font-bold text-white" id="score-market">8</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="bar-market"
                                            class="bg-green-400 h-2 rounded-full transition-all duration-500"
                                            style="width: 80%"></div>
                                    </div>
                                </div>

                                <!-- Competition -->
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-white" id="score-competition-label">‚öîÔ∏è
                                            Competition</span>
                                        <span class="text-sm font-bold text-white" id="score-competition">6</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="bar-competition"
                                            class="bg-yellow-400 h-2 rounded-full transition-all duration-500"
                                            style="width: 60%"></div>
                                    </div>
                                </div>

                                <!-- Feasibility -->
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-white">üõ† Uygulanabilirlik</span>
                                        <span class="text-sm font-bold text-white" id="score-feasibility">7</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="bar-feasibility"
                                            class="bg-blue-400 h-2 rounded-full transition-all duration-500"
                                            style="width: 70%"></div>
                                    </div>
                                </div>

                                <!-- Profitability -->
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-white">üí∞ K√¢rlƒ±lƒ±k</span>
                                        <span class="text-sm font-bold text-white" id="score-profitability">8</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="bar-profitability"
                                            class="bg-green-400 h-2 rounded-full transition-all duration-500"
                                            style="width: 80%"></div>
                                    </div>
                                </div>

                                <!-- Innovation -->
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-white">üí° Yenilik√ßilik</span>
                                        <span class="text-sm font-bold text-white" id="score-innovation">9</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="bar-innovation"
                                            class="bg-purple-400 h-2 rounded-full transition-all duration-500"
                                            style="width: 90%"></div>
                                    </div>
                                </div>

                                <!-- Timing -->
                                <div class="bg-white/10 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-semibold text-white">‚è∞ Zamanlama</span>
                                        <span class="text-sm font-bold text-white" id="score-timing">7</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div id="bar-timing"
                                            class="bg-blue-400 h-2 rounded-full transition-all duration-500"
                                            style="width: 70%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="result-text" class="prose max-w-none text-sm md:text-base"></div>

                        <!-- Charts Section (Analysis Enhancement #4) -->
                        <div id="charts-section" class="hidden mt-6 space-y-4">
                            <!-- Market Growth Chart -->
                            <div
                                class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700">
                                <h3 id="chart-market-title"
                                    class="text-lg font-bold mb-4 text-gray-900 dark:text-white">üìà Market Growth Trend
                                </h3>
                                <canvas id="market-growth-chart"></canvas>
                            </div>

                            <!-- Revenue Projection Chart -->
                            <div
                                class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700">
                                <h3 id="chart-revenue-title"
                                    class="text-lg font-bold mb-4 text-gray-900 dark:text-white">üí∞ Revenue Projection
                                    (First Year)</h3>
                                <canvas id="revenue-chart"></canvas>
                            </div>

                            <!-- Competitor Comparison -->
                            <div id="competitor-section"
                                class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hidden">
                                <h3 id="comp-table-title" class="text-lg font-bold mb-4 text-gray-900 dark:text-white">
                                    ‚öîÔ∏è Competitor
                                    Comparison</h3>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead>
                                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                                <th id="th-comp"
                                                    class="text-left py-2 px-3 text-gray-900 dark:text-white">Competitor
                                                </th>
                                                <th id="th-user"
                                                    class="text-left py-2 px-3 text-gray-900 dark:text-white">User
                                                </th>
                                                <th id="th-rev"
                                                    class="text-left py-2 px-3 text-gray-900 dark:text-white">Revenue
                                                </th>
                                                <th id="th-score"
                                                    class="text-left py-2 px-3 text-gray-900 dark:text-white">Score</th>
                                            </tr>
                                        </thead>
                                        <tbody id="competitor-table-body">
                                            <!-- Will be populated dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Google Trends Card (Analysis Enhancement #9) -->
                        <div id="trends-card"
                            class="hidden mt-6 bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 rounded-xl p-6 border-2 border-red-300 dark:border-red-700">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="text-4xl">üî•</div>
                                <div>
                                    <h3 id="trends-title-text" class="text-xl font-bold text-gray-900 dark:text-white">
                                        Google Trends Analizi
                                    </h3>
                                    <p id="trends-subtitle-text" class="text-xs text-gray-600 dark:text-gray-400">Ger√ßek
                                        zamanlƒ± pazar trendi</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                    <div id="trends-keyword-label"
                                        class="text-sm text-gray-600 dark:text-gray-400 mb-1">Anahtar Kelime</div>
                                    <div class="font-bold text-lg dark:text-white" id="trends-keyword">-</div>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                    <div id="trends-status-label" class="text-sm text-gray-600 dark:text-gray-400 mb-1">
                                        Trend Durumu</div>
                                    <div class="flex items-center gap-2">
                                        <span id="trends-direction" class="font-bold text-lg">‚¨ÜÔ∏è Y√ºkseli≈üte</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mb-4">
                                <div id="trends-history-label" class="text-sm font-semibold mb-2 dark:text-white">ƒ∞lgi
                                    D√ºzeyi (Son 12 Ay)</div>
                                <canvas id="trends-interest-chart" height="80"></canvas>
                            </div>

                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                <div id="trends-related-label" class="text-sm font-semibold mb-2 dark:text-white">ƒ∞lgili
                                    Aramalar</div>
                                <div id="trends-related" class="flex flex-wrap gap-2">
                                    <!-- Will be populated -->
                                </div>
                            </div>

                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-3 text-center" id="trends-source">
                                üìä Source: Google Trends
                            </div>
                        </div>

                        <!-- Email Capture Form (Phase 2) -->
                        <div id="email-capture-section"
                            class="bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-400 rounded-xl p-4 md:p-6 mt-6 hidden">
                            <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
                                <div class="text-4xl">üìß</div>
                                <div class="flex-grow w-full">
                                    <h3 class="font-bold text-lg mb-2 text-gray-800 dark:text-yellow-100"
                                        id="email-capture-title">Raporunu e-postana g√∂nderelim mi?</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-4" id="email-capture-desc">
                                        üìÑ PDF rapor + üîî Yeni √∂zellikler hakkƒ±nda bildirim al
                                    </p>
                                    <form id="email-capture-form" class="flex flex-col sm:flex-row gap-2">
                                        <input type="email" id="user-email" placeholder="email@example.com"
                                            class="flex-grow px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm"
                                            required />
                                        <button type="submit"
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-bold transition shadow-lg whitespace-nowrap text-sm"
                                            id="email-submit-btn">
                                            G√ñNDER üöÄ
                                        </button>
                                    </form>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" id="email-privacy-text">
                                        üîí E-postanƒ±z g√ºvende. Spam g√∂ndermiyoruz.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Follow-up Questions Section (Analysis Enhancement #8) -->
                    <div id="qa-section"
                        class="hidden mt-6 bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700">
                        <h3 id="qa-title-text" class="text-lg font-bold mb-4 text-gray-900 dark:text-white">üí¨ Rapor
                            Hakkƒ±nda Soru Sor</h3>

                        <!-- Quick Questions -->
                        <div class="flex flex-wrap gap-2 mb-4">
                            <button onclick="askQuickQuestion('Rakiplere nasƒ±l √ºst√ºnl√ºk saƒülarƒ±m?')"
                                class="text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-3 py-1.5 rounded-full hover:bg-blue-200 dark:hover:bg-blue-900/50">
                                Rakiplere kar≈üƒ± avantajƒ±m ne?
                            </button>
                            <button onclick="askQuickQuestion('ƒ∞lk m√º≈üterimi nasƒ±l bulurum?')"
                                class="text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-3 py-1.5 rounded-full hover:bg-green-200 dark:hover:bg-green-900/50">
                                ƒ∞lk m√º≈üterimi nasƒ±l bulurum?
                            </button>
                            <button onclick="askQuickQuestion('En b√ºy√ºk risk nedir?')"
                                class="text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-3 py-1.5 rounded-full hover:bg-orange-200 dark:hover:bg-orange-900/50">
                                En b√ºy√ºk riskler?
                            </button>
                        </div>

                        <!-- Chat Messages -->
                        <div id="qa-chat" class="space-y-3 mb-4 max-h-60 overflow-y-auto"></div>

                        <!-- Input -->
                        <div class="flex gap-2">
                            <input type="text" id="qa-input" placeholder="Sorunuzu yazƒ±n..."
                                class="flex-1 px-4 py-2 border rounded-lg dark:bg-gray-700 dark:text-white dark:border-gray-600 text-sm"
                                onkeypress="if(event.key==='Enter') askFollowupQuestion()" />
                            <button onclick="askFollowupQuestion()" id="qa-btn"
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>

                    <div class="bg-gray-800 p-4 border-t border-gray-700">
                        <div class="flex flex-wrap gap-2 justify-between items-center mb-3">
                            <a href="https://www.buymeacoffee.com" target="_blank"
                                class="text-yellow-400 hover:text-yellow-300 text-xs font-bold flex items-center">
                                <i class="fas fa-coffee mr-1"></i> <span id="support-text">Support Us</span>
                            </a>
                            <button id="download-pdf-btn"
                                class="bg-red-600 active:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow flex items-center gap-2 text-sm">
                                <i class="fas fa-file-pdf"></i> <span id="pdf-btn-text">Download PDF</span>
                            </button>
                        </div>
                        <div class="border-t border-gray-700 pt-3">
                            <p class="text-xs text-gray-400 mb-2" id="share-title">Share:</p>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="shareToTwitter()"
                                    class="bg-blue-400 hover:bg-blue-500 text-white px-3 py-2 rounded-lg flex items-center gap-2 text-xs font-semibold transition">
                                    <i class="fab fa-twitter"></i> Twitter
                                </button>
                                <button onclick="shareToLinkedIn()"
                                    class="bg-blue-700 hover:bg-blue-800 text-white px-3 py-2 rounded-lg flex items-center gap-2 text-xs font-semibold transition">
                                    <i class="fab fa-linkedin"></i> LinkedIn
                                </button>
                                <button onclick="copyLink()"
                                    class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg flex items-center gap-2 text-xs font-semibold transition">
                                    <i class="fas fa-link"></i> <span id="copy-link-text">Copy Link</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <footer class="w-full bg-gray-900 border-t border-gray-800 mt-12 py-8">
        <div
            class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center text-sm text-gray-500">
            <div class="mb-4 md:mb-0">
                &copy; 2024 AI Idea Refiner. <span id="footer-rights">All rights reserved.</span>
            </div>
            <div class="flex flex-col md:flex-row gap-6 items-center">
                <a href="about.html" class="hover:text-blue-400 transition" id="footer-about">About Us</a>
                <a href="privacy.html" class="hover:text-blue-400 transition" id="footer-privacy">Privacy Policy</a>
                <a href="terms.html" class="hover:text-blue-400 transition" id="footer-terms">Terms of Use</a>
            </div>

            <!-- Community Links (Phase 3) -->
            <div class="flex gap-4 items-center mt-4 md:mt-0">
                <span class="text-gray-400 text-xs font-bold">Join Community:</span>
                <a href="#" target="_blank" class="text-gray-400 hover:text-blue-400 transition" title="Discord">
                    <i class="fab fa-discord text-xl"></i>
                </a>
                <a href="#" target="_blank" class="text-gray-400 hover:text-blue-400 transition" title="Twitter">
                    <i class="fab fa-twitter text-xl"></i>
                </a>
                <a href="#" target="_blank" class="text-gray-400 hover:text-blue-400 transition" title="Telegram">
                    <i class="fab fa-telegram text-xl"></i>
                </a>
            </div>

            <div class="flex flex-wrap gap-4 items-center justify-center md:justify-end mt-4 md:mt-0">
                <a href="https://turbo0.com/item/ai-idea-refiner" target="_blank" rel="noopener noreferrer">
                    <img src="https://img.turbo0.com/badge-listed-dark.svg" alt="Listed on Turbo0"
                        style="height: 54px; width: auto;" />
                </a>
                <a href="https://findly.tools/ai-idea-refiner?utm_source=ai-idea-refiner" target="_blank">
                    <img src="https://findly.tools/badges/findly-tools-badge-dark.svg" alt="Featured on findly.tools"
                        width="150" />
                </a>
            </div>
    </footer>

    <script>
        const els = {
            langSelect: document.getElementById('lang-select'), heroTitle: document.getElementById('hero-title'), heroDesc: document.getElementById('hero-desc'), input: document.getElementById('idea-input'), btn: document.getElementById('analyze-btn'), btnText: document.getElementById('btn-text'), reportTitle: document.getElementById('report-title'), historyTitle: document.getElementById('history-title'), pdfBtnText: document.getElementById('pdf-btn-text'), spinner: document.getElementById('loading-spinner'), resultArea: document.getElementById('result-area'), resultText: document.getElementById('result-text'), historyList: document.getElementById('history-list'), metaDesc: document.getElementById('meta-desc'), navFbText: document.getElementById('nav-fb-text'), historyClearBtn: document.getElementById('history-clear-btn'), supportText: document.getElementById('support-text'), fbTitle: document.getElementById('fb-title'), fbEmailLabel: document.getElementById('fb-email-label'), fbMsgLabel: document.getElementById('fb-msg-label'), fbMsgInput: document.getElementById('fb-msg-input'), fbSubmitBtn: document.getElementById('fb-submit-btn'), cookieText: document.getElementById('cookie-text'), cookieRejectBtn: document.getElementById('cookie-reject-btn'), cookieAcceptBtn: document.getElementById('cookie-accept-btn'), footerRights: document.getElementById('footer-rights'), footerAbout: document.getElementById('footer-about'), footerPrivacy: document.getElementById('footer-privacy'), footerTerms: document.getElementById('footer-terms')
        };

        const trans = {
            en: {
                alert: 'Please enter an idea!',
                btn: 'Analyze',
                title: 'Analyze Your <span class="text-blue-500">Startup Idea</span> in 60 Seconds',
                desc: 'Deep AI analysis powered by Llama 3.3.',
                ph: 'Type your idea here...',
                pdfBtn: 'Download PDF',
                metaDesc: 'Analyze your startup ideas instantly with AI.',
                navFb: 'Feedback',
                histTitle: 'HISTORY',
                histClear: 'Clear',
                repTitle: 'Analysis Report',
                support: 'Support Us',
                fbTitle: 'Feedback & Contact',
                fbEmail: 'Email (Optional)',
                fbMsg: 'Message',
                fbPh: 'What\'s on your mind?',
                fbSubmit: 'Send üöÄ',
                cookieTxt: 'We use cookies to provide a better experience.',
                cookieRej: 'Reject',
                cookieAcc: 'Accept',
                fRights: 'All rights reserved.',
                fAbout: 'About Us',
                fPrivacy: 'Privacy Policy',
                fTerms: 'Terms of Use',
                navCompare: '‚öñÔ∏è Compare',
                compareTitle: '‚öñÔ∏è Idea Comparison',
                compA: 'Idea A',
                compB: 'Idea B',
                compareBtn: 'üîÑ Compare Ideas',
                compPros: '‚úÖ Pros:',
                compCons: '‚ùå Cons:',
                aiRec: 'AI Recommendation',
                newCompare: 'New Comparison',
                scoreTitle: 'Overall Score (out of 10)',
                mktSize: 'üìä Market Size',
                competition: '‚öîÔ∏è Competition',
                feasibility: '‚öôÔ∏è Feasibility',
                profitability: 'üí∞ Profitability',
                innovation: 'üí° Innovation',
                timing: '‚è∞ Timing',
                qualityLabel: 'Idea Quality:',
                wordCount: 'words',
                trendsTitle: 'Google Trends Analysis',
                trendsSubtitle: 'Real-time market trend',
                trendsKeyword: 'Keyword',
                trendsStatus: 'Trend Status',
                trendsHistory: 'Interest Over Time (Last 12 Months)',
                trendsRelated: 'Related Queries',
                qaTitle: 'üí¨ Ask About Report',
                qaBtn: 'Send',
                qaPh: 'Ask a question...',
                quickQ1: 'What is my advantage?',
                quickQ2: 'How to find first customer?',
                quickQ3: 'Biggest risks?',
                loading: 'Thinking...',
                lTitle: 'Analyzing...',
                lMsg: 'Gathering market data',
                lSub: '‚è±Ô∏è Average time: 15-20 seconds',
                feat1: 'Market Analysis',
                feat2: 'Competitor Analysis',
                feat3: 'Cost Estimation',
                heroAnalyze: 'ANALYZE FOR FREE',
                heroExample: 'SEE EXAMPLE REPORT',
                trendRising: 'Rising',
                trendFalling: 'Falling',
                trendStable: 'Stable',
                chartMarketLabel: 'Market Value (Index)',
                chartValue: 'Value',
                chartRevenueLabel: 'Revenue ($)',
                chartRevenue: 'Revenue',
                chartInterestLabel: 'Interest Level',
                chartMarketTitle: 'üìà Market Growth Trend',
                chartRevenueTitle: 'üí∞ Revenue Projection (First Year)',
                compTableTitle: '‚öîÔ∏è Competitor Comparison',
                thComp: 'Competitor',
                thUser: 'Users',
                thRev: 'Revenue',
                thScore: 'Score',
                trendsSource: 'üìä Source: Google Trends',
                shareTitle: 'Share:',
                copyLink: 'Copy Link'
            },
            tr: {
                alert: 'L√ºtfen bir fikir girin!',
                btn: 'Analiz Et',
                title: 'Giri≈üimcilik Fikrinizi <span class="text-blue-500">60 Saniyede</span> Analiz Edin',
                desc: 'Llama 3.3 ile derinlemesine yapay zeka analizi.',
                ph: 'Fikrinizi buraya yazƒ±n...',
                pdfBtn: 'PDF ƒ∞ndir',
                metaDesc: 'Giri≈üimcilik fikirlerinizi yapay zeka ile analiz edin.',
                navFb: '√ñneri',
                histTitle: 'GE√áMƒ∞≈û',
                histClear: 'Temizle',
                repTitle: 'Analiz Raporu',
                support: 'Destek Ol',
                fbTitle: '√ñneri & ƒ∞leti≈üim',
                fbEmail: 'E-Posta (Opsiyonel)',
                fbMsg: 'Mesajƒ±nƒ±z',
                fbPh: 'Fikriniz nedir?',
                fbSubmit: 'G√∂nder üöÄ',
                cookieTxt: 'Size daha iyi hizmet sunmak i√ßin √ßerezleri kullanƒ±yoruz.',
                cookieRej: 'Reddet',
                cookieAcc: 'Kabul Et',
                fRights: 'T√ºm haklarƒ± saklƒ±dƒ±r.',
                fAbout: 'Hakkƒ±mƒ±zda',
                fPrivacy: 'Gizlilik Politikasƒ±',
                fTerms: 'Kullanƒ±m Ko≈üullarƒ±',
                navCompare: '‚öñÔ∏è Kar≈üƒ±la≈ütƒ±r',
                compareTitle: '‚öñÔ∏è Fikir Kar≈üƒ±la≈ütƒ±rmasƒ±',
                compA: 'Fikir A',
                compB: 'Fikir B',
                compareBtn: 'üîÑ Kar≈üƒ±la≈ütƒ±r',
                compPros: '‚úÖ Artƒ±lar:',
                compCons: '‚ùå Eksiler:',
                aiRec: 'AI Tavsiyesi',
                newCompare: 'Yeni Kar≈üƒ±la≈ütƒ±rma',
                scoreTitle: 'Genel Skor (10 √ºzerinden)',
                mktSize: 'üìä Pazar B√ºy√ºkl√ºƒü√º',
                competition: '‚öîÔ∏è Rekabet',
                feasibility: '‚öôÔ∏è Uygulanabilirlik',
                profitability: 'üí∞ Karlƒ±lƒ±k',
                innovation: 'üí° ƒ∞novasyon',
                timing: '‚è∞ Zamanlama',
                qualityLabel: 'Fikir Kalitesi:',
                wordCount: 'kelime',
                trendsTitle: 'Google Trends Analizi',
                trendsSubtitle: 'Ger√ßek zamanlƒ± pazar trendi',
                trendsKeyword: 'Anahtar Kelime',
                trendsStatus: 'Trend Durumu',
                trendsHistory: 'ƒ∞lgi D√ºzeyi (Son 12 Ay)',
                trendsRelated: 'ƒ∞lgili Aramalar',
                qaTitle: 'üí¨ Rapor Hakkƒ±nda Soru Sor',
                qaBtn: 'G√∂nder',
                qaPh: 'Sorunuzu yazƒ±n...',
                quickQ1: 'Avantajƒ±m ne?',
                quickQ2: 'ƒ∞lk m√º≈üteriyi nasƒ±l bulurum?',
                quickQ3: 'En b√ºy√ºk riskler?',
                loading: 'D√º≈ü√ºn√ºyorum...',
                lTitle: 'Analiz Ediliyor...',
                lMsg: 'Pazar verileri toplanƒ±yor',
                lSub: '‚è±Ô∏è Ortalama s√ºre: 15-20 saniye',
                feat1: 'Pazar Analizi',
                feat2: 'Rakip Kar≈üƒ±la≈ütƒ±rmasƒ±',
                feat3: 'Maliyet Tahmini',
                heroAnalyze: '√úCRETSƒ∞Z ANALƒ∞Z ET',
                heroExample: '√ñRNEK RAPOR G√ñR',
                trendRising: 'Y√ºkseli≈üte',
                trendFalling: 'D√º≈ü√º≈üte',
                trendStable: 'Stabil',
                chartMarketLabel: 'Pazar Deƒüeri (Endeks)',
                chartValue: 'Deƒüer',
                chartRevenueLabel: 'Gelir ($)',
                chartRevenue: 'Gelir',
                chartInterestLabel: 'ƒ∞lgi D√ºzeyi',
                chartMarketTitle: 'üìà Pazar B√ºy√ºme Trendi',
                chartRevenueTitle: 'üí∞ Gelir Projeksiyonu (ƒ∞lk Yƒ±l)',
                compTableTitle: '‚öîÔ∏è Rakip Kar≈üƒ±la≈ütƒ±rmasƒ±',
                thComp: 'Rakip',
                thUser: 'Kullanƒ±cƒ±',
                thRev: 'Gelir',
                thScore: 'Skor',
                trendsSource: 'üìä Kaynak: Google Trends',
                shareTitle: 'Payla≈ü:',
                copyLink: 'Link Kopyala'
            }
        };

        function updateLanguage(lang) {
            document.documentElement.lang = lang;
            const t = trans[lang];
            // Update all areas
            if (els.heroTitle) els.heroTitle.innerHTML = t.title;
            if (els.heroDesc) els.heroDesc.innerText = t.desc;
            if (els.btnText) els.btnText.innerText = t.btn;
            if (els.input) els.input.placeholder = t.ph;
            if (els.metaDesc) els.metaDesc.content = t.metaDesc;
            if (els.navFbText) els.navFbText.innerText = t.navFb;
            if (els.historyTitle) els.historyTitle.innerText = t.histTitle;
            if (els.historyClearBtn) els.historyClearBtn.innerText = t.histClear;
            if (els.reportTitle) els.reportTitle.innerText = t.repTitle;
            if (els.supportText) els.supportText.innerText = t.support;
            if (els.pdfBtnText) els.pdfBtnText.innerText = t.pdfBtn;
            if (els.fbTitle) els.fbTitle.innerText = t.fbTitle;
            if (els.fbEmailLabel) els.fbEmailLabel.innerText = t.fbEmail;
            if (els.fbMsgLabel) els.fbMsgLabel.innerText = t.fbMsg;
            if (els.fbMsgInput) els.fbMsgInput.placeholder = t.fbPh;
            if (els.fbSubmitBtn) els.fbSubmitBtn.innerText = t.fbSubmit;
            if (els.cookieText) els.cookieText.innerText = t.cookieTxt;
            if (els.cookieRejectBtn) els.cookieRejectBtn.innerText = t.cookieRej;
            if (els.cookieAcceptBtn) els.cookieAcceptBtn.innerText = t.cookieAcc;
            if (els.footerRights) els.footerRights.innerText = t.fRights;
            if (els.footerAbout) els.footerAbout.innerText = t.fAbout;
            if (els.footerPrivacy) els.footerPrivacy.innerText = t.fPrivacy;
            if (els.footerTerms) els.footerTerms.innerText = t.fTerms;

            // Missing UI elements
            const updateIfExists = (id, text) => { const el = document.getElementById(id); if (el) el.innerText = text; };
            updateIfExists('loading-title', t.lTitle);
            updateIfExists('loading-message', t.lMsg);
            updateIfExists('loading-sub', t.lSub);
            updateIfExists('feat-1', t.feat1);
            updateIfExists('feat-2', t.feat2);
            updateIfExists('feat-3', t.feat3);
            updateIfExists('hero-analyze-btn', t.heroAnalyze);
            updateIfExists('hero-example-btn', t.heroExample);
            updateIfExists('quality-title-label', t.qualityLabel);
            updateIfExists('share-title', t.shareTitle);
            updateIfExists('copy-link-text', t.copyLink);

            // Charts & Tables
            updateIfExists('chart-market-title', t.chartMarketTitle);
            updateIfExists('chart-revenue-title', t.chartRevenueTitle);
            updateIfExists('comp-table-title', t.compTableTitle);
            updateIfExists('th-comp', t.thComp);
            updateIfExists('th-user', t.thUser);
            updateIfExists('th-rev', t.thRev);
            updateIfExists('th-score', t.thScore);

            // New Features Translations
            updateIfExists('nav-compare', t.navCompare);
            updateIfExists('compare-title', t.compareTitle);
            updateIfExists('compare-label-a', t.compA);
            updateIfExists('compare-label-b', t.compB);
            updateIfExists('compare-btn-text', t.compareBtn);
            updateIfExists('ai-rec-title', t.aiRec);
            updateIfExists('new-compare-btn', t.newCompare);

            document.querySelectorAll('.comp-pros-title').forEach(el => el.innerText = t.compPros);
            document.querySelectorAll('.comp-cons-title').forEach(el => el.innerText = t.compCons);

            updateIfExists('overall-score-title', t.scoreTitle);
            updateIfExists('score-market-label', t.mktSize);
            updateIfExists('score-competition-label', t.competition);
            updateIfExists('score-feasibility-label', t.feasibility);
            updateIfExists('score-profitability-label', t.profitability);
            updateIfExists('score-innovation-label', t.innovation);
            updateIfExists('score-timing-label', t.timing);

            updateIfExists('trends-title-text', t.trendsTitle);
            updateIfExists('trends-subtitle-text', t.trendsSubtitle);
            updateIfExists('trends-keyword-label', t.trendsKeyword);
            updateIfExists('trends-status-label', t.trendsStatus);
            updateIfExists('trends-history-label', t.trendsHistory);
            updateIfExists('trends-related-label', t.trendsRelated);
            updateIfExists('trends-source', t.trendsSource);

            updateIfExists('qa-title-text', t.qaTitle);
            updateIfExists('qa-btn', t.qaBtn);
            if (document.getElementById('qa-input')) document.getElementById('qa-input').placeholder = t.qaPh;

            // Quick Questions
            const qqBtns = document.querySelectorAll('#qa-section .flex.flex-wrap button');
            if (qqBtns.length === 3) {
                qqBtns[0].innerText = t.quickQ1;
                qqBtns[1].innerText = t.quickQ2;
                qqBtns[2].innerText = t.quickQ3;
            }
        }

        if (els.langSelect) {
            els.langSelect.addEventListener('change', () => {
                updateLanguage(els.langSelect.value);
            });
        }

        // --- SAYFA Y√úKLENƒ∞NCE (VARSAYILAN: ƒ∞NGƒ∞Lƒ∞ZCE) ---
        document.addEventListener('DOMContentLoaded', () => {
            updateLanguage('en');
            loadHistorySafe();
            checkCookies();

            if (els.btn) {
                els.btn.addEventListener('click', async () => {
                    const text = els.input.value.trim();
                    const lang = els.langSelect.value;
                    if (!text) return alert(trans[lang].alert);

                    // Track analytics
                    gtag('event', 'analyze_clicked', { idea_length: text.length });

                    // Show loading screen
                    document.getElementById('loading-screen').classList.remove('hidden');
                    simulateProgress();

                    els.btn.disabled = true; els.btnText.classList.add('hidden'); els.spinner.classList.remove('hidden'); els.resultArea.classList.add('hidden');
                    try {
                        const res = await fetch('/api/analyze', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ idea: text, language: lang }) });
                        const data = await res.json();
                        if (data.error) throw new Error(data.error);
                        if (typeof marked !== 'undefined') els.resultText.innerHTML = marked.parse(data.result); else els.resultText.innerText = data.result;

                        // Store for Q&A (Analysis Enhancement #8)
                        currentAnalysis = data.result;
                        currentIdea = text;

                        // Hide loading screen
                        document.getElementById('loading-screen').classList.add('hidden');

                        els.resultArea.classList.remove('hidden', 'opacity-0'); els.resultArea.style.display = 'block';
                        setTimeout(() => els.resultArea.scrollIntoView({ behavior: 'smooth' }), 100);
                        saveToHistory(text);
                        incrementAnalysisCounter();
                        gtag('event', 'result_viewed');

                        // Update score card (Analysis Enhancement #1)
                        if (data.scoring) {
                            updateScoreCard(data.scoring);
                        }

                        // Render charts (Analysis Enhancement #4)
                        if (data.charts) {
                            renderCharts(data.charts);
                        }

                        // Render Google Trends (Analysis Enhancement #9)
                        if (data.trends) {
                            renderTrendsCard(data.trends);
                        }

                        // Show email capture section (Phase 2)
                        setTimeout(() => showEmailCapture(), 500);

                        // Show Q&A section (Analysis Enhancement #8)
                        setTimeout(() => showQASection(), 2000);
                    } catch (e) {
                        document.getElementById('loading-screen').classList.add('hidden');
                        alert("Error: " + e.message);
                    }
                    finally { els.btn.disabled = false; els.btnText.classList.remove('hidden'); els.spinner.classList.add('hidden'); }
                });
            }

            document.getElementById('theme-toggle').addEventListener('click', () => document.documentElement.classList.toggle('dark'));

            document.getElementById('download-pdf-btn').addEventListener('click', () => {
                gtag('event', 'pdf_downloaded');
                const btn = document.getElementById('download-pdf-btn'); const oldText = btn.innerHTML; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ...'; btn.disabled = true; const contentHTML = document.getElementById('result-text').innerHTML; const pdfContainer = document.getElementById('pdf-generator-container');
                pdfContainer.innerHTML = `<div style="border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px; display: flex; align-items: center;"><img src="https://cdn-icons-png.flaticon.com/512/8637/8637103.png" style="width: 50px; height: 50px; margin-right: 15px;"><div><h1 style="font-size: 24px; color: #2563eb; margin: 0;">AI Idea Refiner - Report</h1><p style="font-size: 12px; color: #666; margin: 5px 0 0 0;">Date: ${new Date().toLocaleDateString()}</p></div></div><div class="pdf-content">${contentHTML}</div><style>.pdf-content h1 { color: #1e40af; font-size: 20px; margin-top: 25px; border-bottom: 1px solid #ccc; } .pdf-content h2 { color: #2563eb; font-size: 18px; margin-top: 20px; } .pdf-content p { color: #000; font-size: 12px; line-height: 1.5; margin-bottom: 10px; } .pdf-content ul { color: #000; padding-left: 20px; } .pdf-content li { margin-bottom: 5px; } .pdf-content strong { color: #000; font-weight: bold; }</style>`;
                const opt = { margin: 0.5, filename: 'Idea_Analysis.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS: true }, jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }, pagebreak: { mode: ['avoid-all', 'css', 'legacy'] } };
                html2pdf().set(opt).from(pdfContainer).save().then(() => { btn.innerHTML = oldText; btn.disabled = false; pdfContainer.innerHTML = "" });
            });
        });

        // === PHASE 1 NEW FUNCTIONS ===

        // Example Report Data (Bilingual)
        const exampleReportEN = `# üìä Data-Driven Market Analysis: 8/10

**Market Size (2025):** $12.5 Billion  
**Annual Growth Rate:** 23.4% CAGR  
**Trend Score:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)

The nutrition and health tech market is growing rapidly. AI-powered personalization solutions are in high demand during 2024-2025.

# üéØ Target Audience

**Primary Persona:**
- Urban professionals aged 25-45
- People following healthy lifestyle trends
- Above-average income level

**Secondary Persona:**
- Regular gym-goers
- People on diets

# ‚öîÔ∏è Competitive Analysis

**Main Competitors:**
- MyFitnessPal (200M+ users)
- Noom (50M+ users)
- Yazio (10M+ users)

**Opportunity:** Existing apps are not personalized enough. You can differentiate with an AI-based recommendation system.

# üí∞ Realistic Revenue Model

**Freemium Model:**
- Free: Basic features
- Premium ($9.99/month): AI-powered custom diet plan

**First Year Estimate:**
- 5,000 active users
- 10% premium conversion
- Monthly revenue: ~$5,000

# üìâ Technical Difficulty & Budget

**Difficulty Level:** Medium (6/10)  
**Development Time:** 4-6 months  
**Initial Budget:** $25,000 - $40,000

**Monthly Expenses:**
- Server: $100-200
- AI API: $300-500
- Marketing: $500-1,000

# üöÄ Roadmap

**Month 1-2:** MVP development  
**Month 3-4:** Beta testing  
**Month 5-6:** Market launch  

# üí° Final Verdict

‚úÖ **Recommended:** This idea has success potential. You can start small and scale up.

**Critical Success Factors:**
- AI algorithm quality
- User experience
- Early marketing strategy
`;

        const exampleReportTR = `# üìä Veri Odaklƒ± Pazar Analizi: 8/10

**Pazar B√ºy√ºkl√ºƒü√º (2025):** $12.5 Milyar  
**Yƒ±llƒ±k B√ºy√ºme Oranƒ±:** %23.4 CAGR  
**Trend Skoru:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)

Beslenme ve saƒülƒ±k teknolojileri pazarƒ± hƒ±zla b√ºy√ºyor. √ñzellikle AI destekli ki≈üiselle≈ütirme √ß√∂z√ºmleri 2024-2025 d√∂neminde y√ºksek talep g√∂r√ºyor.

# üéØ Hedef Kitle

**Birincil Persona:**
- 25-45 ya≈ü arasƒ± kentli profesyoneller
- Saƒülƒ±klƒ± ya≈üam trendini takip edenler
- Ortalama gelir seviyesi y√ºksek

**ƒ∞kincil Persona:**
- Fitness salonlarƒ±na d√ºzenli giden kullanƒ±cƒ±lar
- Diyet yapan bireyler

# ‚öîÔ∏è Rekabet Analizi

**Ana Rakipler:**
- MyFitnessPal (200M+ kullanƒ±cƒ±)
- Noom (50M+ kullanƒ±cƒ±)
- Yazio (10M+ kullanƒ±cƒ±)

**Fƒ±rsat:** Mevcut uygulamalar yeterince ki≈üiselle≈ütirilmi≈ü deƒüil. AI temelli √∂neri sistemi ile fark yaratabilirsiniz.

# üí∞ Ger√ßek√ßi Gelir Modeli

**Freemium Model:**
- √úcretsiz: Temel √∂zellikler
- Premium ($9.99/ay): AI destekli √∂zel diyet planƒ±

**ƒ∞lk Yƒ±l Tahmini:**
- 5,000 aktif kullanƒ±cƒ±
- %10 premium d√∂n√º≈ü√ºm
- Aylƒ±k gelir: ~$5,000

# üìâ Teknik Zorluk ve B√ºt√ße

**Zorluk Seviyesi:** Orta (6/10)  
**Geli≈ütirme S√ºresi:** 4-6 ay  
**Ba≈ülangƒ±√ß B√ºt√ßesi:** $25,000 - $40,000

**Aylƒ±k Giderler:**
- Sunucu: $100-200
- AI API: $300-500
- Pazarlama: $500-1,000

# üöÄ Yol Haritasƒ±

**Ay 1-2:** MVP geli≈ütirme  
**Ay 3-4:** Beta test  
**Ay 5-6:** Piyasaya s√ºr√ºm  

# üí° Son Karar

‚úÖ **√ñnerilen:** Bu fikir ba≈üarƒ± potansiyeli ta≈üƒ±yor. K√º√ß√ºk ba≈ülayƒ±p b√ºy√ºyebilirsiniz.

**Kritik Ba≈üarƒ± Fakt√∂rleri:**
- AI algoritmasƒ± kalitesi
- Kullanƒ±cƒ± deneyimi
- Erken pazarlama stratejisi
`;

        function showExampleReport() {
            gtag('event', 'example_report_viewed');
            const lang = document.getElementById('lang-select').value;
            const report = lang === 'tr' ? exampleReportTR : exampleReportEN;

            if (typeof marked !== 'undefined') {
                els.resultText.innerHTML = marked.parse(report);
            } else {
                els.resultText.innerText = report;
            }

            // Show notification banner (bilingual)
            const bannerText = lang === 'tr'
                ? 'üìå Bu bir √∂rnek rapor. Kendi fikrinizi analiz etmek i√ßin a≈üaƒüƒ±daki kutuya yazƒ±n.'
                : 'üìå This is an example report. Enter your own idea in the text box below to analyze it.';

            const banner = document.createElement('div');
            banner.className = 'bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-400 rounded-xl p-4 mb-4';
            banner.innerHTML = `<p class="text-sm font-bold text-yellow-800 dark:text-yellow-200">${bannerText}</p>`;
            els.resultArea.querySelector('.bg-gray-900').prepend(banner);

            els.resultArea.classList.remove('hidden', 'opacity-0');
            els.resultArea.style.display = 'block';
            setTimeout(() => els.resultArea.scrollIntoView({ behavior: 'smooth' }), 100);
        }

        function scrollToInput() {
            gtag('event', 'scroll_to_input_clicked');
            document.getElementById('idea-input').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('idea-input').focus();
        }

        function shareToTwitter() {
            const lang = document.getElementById('lang-select').value;
            const textEN = `I analyzed my startup idea with AI! üöÄ\n\n‚úÖ Market Analysis\n‚úÖ Competitor Comparison\n‚úÖ Revenue Model\n\nTry it yourself:`;
            const textTR = `Giri≈üimcilik fikrimi AI ile analiz ettim! üöÄ\n\n‚úÖ Pazar Analizi\n‚úÖ Rakip Kar≈üƒ±la≈ütƒ±rmasƒ±\n‚úÖ Gelir Modeli\n\nSen de dene:`;
            const text = lang === 'tr' ? textTR : textEN;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank', 'width=550,height=420');
            gtag('event', 'share', { method: 'Twitter' });
        }

        function shareToLinkedIn() {
            const url = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank', 'width=550,height=420');
            gtag('event', 'share', { method: 'LinkedIn' });
        }

        function copyLink() {
            const lang = document.getElementById('lang-select').value;
            const copiedText = lang === 'tr' ? 'Kopyalandƒ±!' : 'Copied!';
            navigator.clipboard.writeText(window.location.href).then(() => {
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = `<i class="fas fa-check"></i> ${copiedText}`;
                setTimeout(() => { btn.innerHTML = originalText; }, 2000);
                gtag('event', 'share', { method: 'Copy Link' });
            });
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // Loading screen progress simulation (bilingual)
        function getLoadingSteps() {
            const lang = document.getElementById('lang-select').value;
            if (lang === 'tr') {
                return [
                    { progress: 20, emoji: 'üîç', title: 'Pazar Analizi', message: '2024-2025 pazar verileri taranƒ±yor...' },
                    { progress: 40, emoji: '‚öîÔ∏è', title: 'Rakip Analizi', message: 'Benzer √ºr√ºnler kar≈üƒ±la≈ütƒ±rƒ±lƒ±yor...' },
                    { progress: 60, emoji: 'üí∞', title: 'Maliyet Hesaplama', message: 'Geli≈ütirme ve i≈ületme giderleri tahmin ediliyor...' },
                    { progress: 80, emoji: 'üìä', title: 'Rapor Hazƒ±rlama', message: 'Sonu√ßlar derleniyor...' },
                    { progress: 100, emoji: '‚úÖ', title: 'Tamamlandƒ±!', message: 'Raporunuz hazƒ±r' }
                ];
            }
            return [
                { progress: 20, emoji: 'üîç', title: 'Market Analysis', message: 'Scanning 2024-2025 market data...' },
                { progress: 40, emoji: '‚öîÔ∏è', title: 'Competitor Analysis', message: 'Comparing similar products...' },
                { progress: 60, emoji: 'üí∞', title: 'Cost Calculation', message: 'Estimating development and operating costs...' },
                { progress: 80, emoji: 'üìä', title: 'Preparing Report', message: 'Compiling results...' },
                { progress: 100, emoji: '‚úÖ', title: 'Complete!', message: 'Your report is ready' }
            ];
        }

        async function simulateProgress() {
            const loadingSteps = getLoadingSteps();
            for (let step of loadingSteps) {
                await new Promise(resolve => setTimeout(resolve, 3000));
                document.getElementById('progress-bar').style.width = step.progress + '%';
                document.getElementById('loading-emoji').textContent = step.emoji;
                document.getElementById('loading-title').textContent = step.title;
                document.getElementById('loading-message').textContent = step.message;
            }
        }

        function incrementAnalysisCounter() {
            // Removed fake counter - does nothing now
        }

        // Track page view
        gtag('event', 'page_view', { page_title: 'Home' });

        // Track idea input started
        document.getElementById('idea-input').addEventListener('focus', function () {
            if (!this.dataset.tracked) {
                gtag('event', 'idea_input_started');
                this.dataset.tracked = 'true';
            }
        });

        // === PHASE 2: EMAIL CAPTURE ===

        // Show email capture section when result is displayed
        function showEmailCapture() {
            const emailSection = document.getElementById('email-capture-section');
            if (emailSection && !localStorage.getItem('email_submitted')) {
                emailSection.classList.remove('hidden');
            }
        }

        // Email capture form handler
        document.getElementById('email-capture-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const emailInput = document.getElementById('user-email');
            const submitBtn = document.getElementById('email-submit-btn');
            const email = emailInput.value.trim();

            if (!email) return;

            // Track analytics
            gtag('event', 'email_captured', { email_domain: email.split('@')[1] });

            // Disable form
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> G√∂nderiliyor...';

            try {
                // Save email to localStorage (in real app, send to backend)
                const emails = JSON.parse(localStorage.getItem('captured_emails') || '[]');
                emails.push({
                    email: email,
                    idea: document.getElementById('idea-input').value.substring(0, 100),
                    date: new Date().toISOString()
                });
                localStorage.setItem('captured_emails', JSON.stringify(emails));
                localStorage.setItem('email_submitted', 'true');

                // Show success message
                document.getElementById('email-capture-section').innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-5xl mb-3">‚úÖ</div>
                        <h3 class="font-bold text-xl text-gray-800 dark:text-green-300 mb-2">Te≈üekk√ºrler!</h3>
                        <p class="text-gray-600 dark:text-gray-300">Raporunuz <strong>${email}</strong> adresine g√∂nderildi.</p>
                    </div>
                `;

                // In production, you would send this to your backend:
                // await fetch('/api/save-email', {
                //     method: 'POST',
                //     headers: {'Content-Type': 'application/json'},
                //     body: JSON.stringify({ email, idea: document.getElementById('idea-input').value })
                // });

            } catch (error) {
                console.error('Email capture error:', error);
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'G√ñNDER üöÄ';
                alert('Bir hata olu≈ütu. L√ºtfen tekrar deneyin.');
            }
        });

        // === ANALYSIS ENHANCEMENT #1: SCORE BREAKDOWN ===

        function updateScoreCard(scoring) {
            const card = document.getElementById('score-card');
            card.classList.remove('hidden');

            const lang = document.getElementById('lang-select').value;
            const t = trans[lang];

            document.getElementById('overall-score').textContent = scoring.overall_score;

            // Update badge text based on language
            const riskBadge = document.getElementById('risk-badge');
            riskBadge.className = 'px-3 py-1 rounded-full text-xs font-bold';

            const riskLevels = {
                tr: { high: 'Y√ºksek Risk', medium: 'Orta Risk', low: 'D√º≈ü√ºk Risk' },
                en: { high: 'High Risk', medium: 'Medium Risk', low: 'Low Risk' }
            };

            if (scoring.risk_level === 'high') {
                riskBadge.textContent = riskLevels[lang].high;
                riskBadge.classList.add('bg-red-500', 'text-white');
            } else if (scoring.risk_level === 'low') {
                riskBadge.textContent = riskLevels[lang].low;
                riskBadge.classList.add('bg-green-500', 'text-white');
            } else {
                riskBadge.textContent = riskLevels[lang].medium;
                riskBadge.classList.add('bg-yellow-500', 'text-black');
            }

            // Simple mapping for scores
            document.getElementById('score-market').textContent = scoring.breakdown.market_size;
            document.getElementById('bar-market').style.width = (scoring.breakdown.market_size * 10) + '%';
            document.getElementById('score-competition').textContent = scoring.breakdown.competition;
            document.getElementById('bar-competition').style.width = (scoring.breakdown.competition * 10) + '%';
            document.getElementById('score-feasibility').textContent = scoring.breakdown.feasibility;
            document.getElementById('bar-feasibility').style.width = (scoring.breakdown.feasibility * 10) + '%';
            document.getElementById('score-profitability').textContent = scoring.breakdown.profitability;
            document.getElementById('bar-profitability').style.width = (scoring.breakdown.profitability * 10) + '%';
            document.getElementById('score-innovation').textContent = scoring.breakdown.innovation;
            document.getElementById('bar-innovation').style.width = (scoring.breakdown.innovation * 10) + '%';
            document.getElementById('score-timing').textContent = scoring.breakdown.timing;
            document.getElementById('bar-timing').style.width = (scoring.breakdown.timing * 10) + '%';
        }

        // === ANALYSIS ENHANCEMENT #4: CHART VISUALIZATION ===

        let marketChart = null;
        let revenueChart = null;

        function renderCharts(chartData) {
            const chartsSection = document.getElementById('charts-section');
            if (chartsSection) chartsSection.classList.remove('hidden');

            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#e5e7eb' : '#1f2937';
            const gridColor = isDark ? '#374151' : '#e5e7eb';

            const lang = document.getElementById('lang-select').value;
            const t = trans[lang];

            // Destroy existing charts if they exist
            if (marketChart) marketChart.destroy();
            if (revenueChart) revenueChart.destroy();

            // Market Growth Chart (Line)
            const marketCtx = document.getElementById('market-growth-chart').getContext('2d');
            marketChart = new Chart(marketCtx, {
                type: 'line',
                data: {
                    labels: chartData.market_growth?.years || [2024, 2025, 2026, 2027, 2028],
                    datasets: [{
                        label: t.chartMarketLabel,
                        data: chartData.market_growth?.values || [100, 120, 145, 175, 210],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${t.chartValue}: ${context.parsed.y}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: textColor },
                            grid: { color: gridColor }
                        },
                        x: {
                            ticks: { color: textColor },
                            grid: { color: gridColor }
                        }
                    }
                }
            });

            // Revenue Projection Chart (Bar)
            const revenueCtx = document.getElementById('revenue-chart').getContext('2d');
            revenueChart = new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: chartData.revenue_projection?.months || ['M 1-3', 'M 4-6', 'M 7-9', 'M 10-12'],
                    datasets: [{
                        label: t.chartRevenueLabel,
                        data: chartData.revenue_projection?.values || [1000, 3000, 7000, 15000],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(168, 85, 247, 0.8)',
                            'rgba(236, 72, 153, 0.8)'
                        ],
                        borderColor: [
                            '#22c55e',
                            '#3b82f6',
                            '#a855f7',
                            '#ec4899'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${t.chartRevenue}: $${context.parsed.y.toLocaleString()}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: textColor,
                                callback: (value) => '$' + value.toLocaleString()
                            },
                            grid: { color: gridColor }
                        },
                        x: {
                            ticks: { color: textColor },
                            grid: { color: gridColor }
                        }
                    }
                }
            });

            // Competitor Table
            if (chartData.competitors && chartData.competitors.length > 0) {
                const competitorSection = document.getElementById('competitor-section');
                const tableBody = document.getElementById('competitor-table-body');

                competitorSection.classList.remove('hidden');
                tableBody.innerHTML = '';

                chartData.competitors.forEach(comp => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 dark:border-gray-700';
                    row.innerHTML = `
                        <td class="py-2 px-3 text-gray-900 dark:text-white font-semibold">${comp.name}</td>
                        <td class="py-2 px-3 text-gray-700 dark:text-gray-300">${comp.users}</td>
                        <td class="py-2 px-3 text-gray-700 dark:text-gray-300">${comp.revenue}</td>
                        <td class="py-2 px-3">
                            <div class="flex items-center gap-2">
                                <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full" style="width: ${comp.score}%"></div>
                                </div>
                                <span class="text-xs text-gray-600 dark:text-gray-400">${comp.score}</span>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Track analytics
            gtag('event', 'charts_displayed', {
                has_competitors: chartData.competitors?.length > 0
            });
        }

        // === ANALYSIS ENHANCEMENT #9: GOOGLE TRENDS VISUALIZATION ===

        let trendsChart = null;

        function renderTrendsCard(trends) {
            const trendsCard = document.getElementById('trends-card');
            trendsCard.classList.remove('hidden');

            const lang = document.getElementById('lang-select').value;
            const t = trans[lang];

            // Update keyword
            document.getElementById('trends-keyword').textContent = trends.keyword || 'N/A';

            // Update trend direction
            const directionEl = document.getElementById('trends-direction');
            const directionIcons = {
                rising: `‚¨ÜÔ∏è ${t.trendRising}`,
                falling: `‚¨áÔ∏è ${t.trendFalling}`,
                stable: `‚û°Ô∏è ${t.trendStable}`
            };
            directionEl.textContent = directionIcons[trends.trendDirection] || `‚û°Ô∏è ${t.trendStable}`;
            directionEl.className = `font-bold text-lg ${trends.trendDirection === 'rising' ? 'text-green-600' :
                trends.trendDirection === 'falling' ? 'text-red-600' :
                    'text-gray-600'
                }`;

            // Render interest chart
            if (trendsChart) trendsChart.destroy();

            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#e5e7eb' : '#1f2937';
            const gridColor = isDark ? '#374151' : '#e5e7eb';

            const ctx = document.getElementById('trends-interest-chart').getContext('2d');
            trendsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: trends.interestOverTime.length }, (_, i) => i + 1),
                    datasets: [{
                        label: t.chartInterestLabel,
                        data: trends.interestOverTime || [50, 52, 55, 58, 60, 62, 65, 63, 61, 59, 57, 55],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: textColor },
                            grid: { color: gridColor }
                        },
                        x: {
                            ticks: { color: textColor },
                            grid: { color: gridColor }
                        }
                    }
                }
            });

            // Update related queries
            const relatedDiv = document.getElementById('trends-related');
            relatedDiv.innerHTML = '';
            (trends.relatedQueries || []).forEach(query => {
                const badge = document.createElement('span');
                badge.className = 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 px-3 py-1 rounded-full text-xs font-semibold';
                badge.textContent = query;
                relatedDiv.appendChild(badge);
            });

            // Track analytics
            gtag('event', 'trends_data_displayed', {
                keyword: trends.keyword,
                trend_direction: trends.trendDirection
            });
        }

        // === ANALYSIS ENHANCEMENT #2: IDEA QUALITY CHECK ===

        function assessIdeaQuality(idea) {
            const lang = document.getElementById('lang-select').value;
            const t = trans[lang];

            if (!idea || idea.length < 5) {
                document.getElementById('quality-feedback').classList.add('hidden');
                return;
            }

            document.getElementById('quality-feedback').classList.remove('hidden');

            const words = idea.split(/\s+/).filter(w => w.length > 0);
            const wordCount = words.length;
            document.getElementById('word-count').textContent = `${wordCount} ${t.wordCount}`;

            // Smart suggestions in both languages
            const suggestions = [];
            const suggestionsEN = {
                short: "‚Ä¢ Your description is a bit short. Add more details.",
                problem: "‚Ä¢ Mention the specific problem you are solving.",
                audience: "‚Ä¢ Define your target audience.",
                money: "‚Ä¢ Mention how you plan to make money.",
                great: "‚Ä¢ Great job! This is a detailed description."
            };
            const suggestionsTR = {
                short: "‚Ä¢ A√ßƒ±klamanƒ±z biraz kƒ±sa. Daha fazla detay ekleyin.",
                problem: "‚Ä¢ √á√∂zd√ºƒü√ºn√ºz spesifik problemden bahsedin.",
                audience: "‚Ä¢ Hedef kitlenizi tanƒ±mlayƒ±n.",
                money: "‚Ä¢ Nasƒ±l para kazanacaƒüƒ±nƒ±zdan bahsedin.",
                great: "‚Ä¢ Harika! √áok detaylƒ± bir a√ßƒ±klama."
            };

            const s = lang === 'tr' ? suggestionsTR : suggestionsEN;

            let score = 0;
            if (wordCount > 10) score += 1;
            if (wordCount > 30) score += 1;

            if (wordCount < 15) suggestions.push(s.short);

            const lowerIdea = idea.toLowerCase();
            const keywordsProblem = ['problem', 'sƒ±kƒ±ntƒ±', '√ß√∂z√ºm', 'sorun', 'solution', 'pain'];
            if (keywordsProblem.some(k => lowerIdea.includes(k))) score += 1; else suggestions.push(s.problem);

            const keywordsAudience = ['user', 'customer', 'kullanƒ±cƒ±', 'm√º≈üteri', 'target', 'kitle', 'people', 'insanlar'];
            if (keywordsAudience.some(k => lowerIdea.includes(k))) score += 1; else suggestions.push(s.audience);

            const keywordsMoney = ['money', 'earn', 'revenue', 'profit', 'kazan√ß', 'para', 'gelir', 'subscription', 'fee'];
            if (keywordsMoney.some(k => lowerIdea.includes(k))) score += 1; else suggestions.push(s.money);

            // Limited to 5 stars
            const finalScore = Math.min(5, score);
            const starsEl = document.getElementById('quality-stars');
            starsEl.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const star = document.createElement('span');
                star.textContent = '‚≠ê';
                star.className = i < finalScore ? 'text-yellow-500' : 'text-gray-300';
                starsEl.appendChild(star);
            }

            const sugEl = document.getElementById('quality-suggestions');
            sugEl.innerHTML = suggestions.length > 0 ? suggestions.join('<br>') : `<span class="text-green-600">${s.great}</span>`;

            gtag('event', 'quality_feedback_shown', { score: finalScore });
        }

        // Updated input event
        document.getElementById('idea-input').addEventListener('input', (e) => assessIdeaQuality(e.target.value));

        // Delete old unused functions
        function awardBadge(id) { }
        function incrementUsage() { }
        function checkUsageLimit() { return true; }
        function showLimitModal() { }
        function closeLimitModal() { }
        function checkAndAwardBadges() { }
        function incrementAnalysisCounter() { }

        // === ANALYSIS ENHANCEMENT #7: COMPARISON MODE ===

        function openCompareModal() {
            document.getElementById('compare-modal').classList.remove('hidden');
            gtag('event', 'compare_modal_opened');
        }

        function closeCompareModal() {
            document.getElementById('compare-modal').classList.add('hidden');
        }

        function resetComparison() {
            document.getElementById('compare-input-section').classList.remove('hidden');
            document.getElementById('compare-results-section').classList.add('hidden');
            document.getElementById('compare-idea-a').value = '';
            document.getElementById('compare-idea-b').value = '';
        }

        document.getElementById('compare-btn').addEventListener('click', async function () {
            const idea1 = document.getElementById('compare-idea-a').value.trim();
            const idea2 = document.getElementById('compare-idea-b').value.trim();
            const lang = document.getElementById('lang-select').value;

            if (!idea1 || !idea2) {
                alert('L√ºtfen her iki fikri de girin!');
                return;
            }

            const btn = this;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Kar≈üƒ±la≈ütƒ±rƒ±lƒ±yor...';

            try {
                const res = await fetch('/api/compare', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idea1, idea2, language: lang })
                });

                const data = await res.json();

                if (data.error) throw new Error(data.error);

                // Hide input, show results
                document.getElementById('compare-input-section').classList.add('hidden');
                document.getElementById('compare-results-section').classList.remove('hidden');

                // Update Idea A
                document.getElementById('name-a').textContent = data.idea_a.name;
                document.getElementById('score-a').textContent = data.idea_a.score;
                const prosA = document.getElementById('pros-a');
                prosA.innerHTML = '';
                data.idea_a.pros.forEach(pro => {
                    const li = document.createElement('li');
                    li.textContent = pro;
                    prosA.appendChild(li);
                });
                const consA = document.getElementById('cons-a');
                consA.innerHTML = '';
                data.idea_a.cons.forEach(con => {
                    const li = document.createElement('li');
                    li.textContent = con;
                    consA.appendChild(li);
                });

                // Update Idea B
                document.getElementById('name-b').textContent = data.idea_b.name;
                document.getElementById('score-b').textContent = data.idea_b.score;
                const prosB = document.getElementById('pros-b');
                prosB.innerHTML = '';
                data.idea_b.pros.forEach(pro => {
                    const li = document.createElement('li');
                    li.textContent = pro;
                    prosB.appendChild(li);
                });
                const consB = document.getElementById('cons-b');
                consB.innerHTML = '';
                data.idea_b.cons.forEach(con => {
                    const li = document.createElement('li');
                    li.textContent = con;
                    consB.appendChild(li);
                });

                // Highlight winner
                const resultA = document.getElementById('result-a');
                const resultB = document.getElementById('result-b');
                if (data.winner === 'a') {
                    resultA.classList.add('border-blue-500');
                    resultB.classList.remove('border-blue-500');
                    resultB.classList.add('border-gray-300', 'dark:border-gray-600');
                } else {
                    resultB.classList.add('border-blue-500');
                    resultA.classList.remove('border-blue-500');
                    resultA.classList.add('border-gray-300', 'dark:border-gray-600');
                }

                // Show recommendation
                document.getElementById('recommendation').textContent = data.recommendation;

                // Track analytics
                gtag('event', 'ideas_compared', {
                    winner: data.winner,
                    score_diff: Math.abs(data.idea_a.score - data.idea_b.score)
                });

            } catch (error) {
                alert('Hata: ' + error.message);
                console.error(error);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Kar≈üƒ±la≈ütƒ±r';
            }
        });


        // === ANALYSIS ENHANCEMENT #8: FOLLOW-UP QUESTIONS ===

        let currentAnalysis = '';
        let currentIdea = '';

        function showQASection() {
            document.getElementById('qa-section').classList.remove('hidden');
        }

        function askQuickQuestion(question) {
            document.getElementById('qa-input').value = question;
            askFollowupQuestion();
        }

        async function askFollowupQuestion() {
            const question = document.getElementById('qa-input').value.trim();
            if (!question) return;

            const lang = document.getElementById('lang-select').value;
            const chat = document.getElementById('qa-chat');
            const btn = document.getElementById('qa-btn');

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'flex justify-end';
            userMsg.innerHTML = `
                <div class="bg-blue-600 text-white px-4 py-2 rounded-lg max-w-[80%] text-sm">
                    ${question}
                </div>
            `;
            chat.appendChild(userMsg);

            // Clear input
            document.getElementById('qa-input').value = '';

            // Show loading
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'flex justify-start';
            loadingMsg.id = 'loading-msg';
            loadingMsg.innerHTML = `
                <div class="bg-gray-200 dark:bg-gray-700 px-4 py-2 rounded-lg text-sm">
                    <i class="fas fa-spinner fa-spin"></i> D√º≈ü√ºn√ºyorum...
                </div>
            `;
            chat.appendChild(loadingMsg);
            chat.scrollTop = chat.scrollHeight;

            btn.disabled = true;

            try {
                const res = await fetch('/api/ask-followup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        original_idea: currentIdea,
                        original_analysis: currentAnalysis,
                        question,
                        language: lang
                    })
                });

                const data = await res.json();

                // Remove loading
                document.getElementById('loading-msg').remove();

                // Add AI response
                const aiMsg = document.createElement('div');
                aiMsg.className = 'flex justify-start';
                aiMsg.innerHTML = `
                    <div class="bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white px-4 py-2 rounded-lg max-w-[80%] text-sm">
                        ${data.answer}
                    </div>
                `;
                chat.appendChild(aiMsg);
                chat.scrollTop = chat.scrollHeight;

                // Track analytics
                gtag('event', 'followup_question_asked', { question_length: question.length });

            } catch (error) {
                document.getElementById('loading-msg').remove();
                alert('Hata: ' + error.message);
                console.error(error);
            } finally {
                btn.disabled = false;
            }
        }

        function toggleFeedback() { const m = document.getElementById('feedback-modal'), c = document.getElementById('feedback-content'); if (m.classList.contains('hidden')) { m.classList.remove('hidden'); setTimeout(() => { c.classList.remove('scale-95', 'opacity-0'); c.classList.add('scale-100', 'opacity-100') }, 10) } else { c.classList.remove('scale-100', 'opacity-100'); c.classList.add('scale-95', 'opacity-0'); setTimeout(() => { m.classList.add('hidden') }, 300) } }
        function checkCookies() { const b = document.getElementById('cookie-banner'); if (!localStorage.getItem('cookiePreference')) { b.classList.remove('hidden'); setTimeout(() => b.classList.remove('translate-y-full'), 100) } }
        function acceptCookies() { localStorage.setItem('cookiePreference', 'accepted'); closeBanner() }
        function rejectCookies() { localStorage.setItem('cookiePreference', 'rejected'); closeBanner() }
        function closeBanner() { const b = document.getElementById('cookie-banner'); b.classList.add('translate-y-full'); setTimeout(() => b.classList.add('hidden'), 500) }
        function loadHistorySafe() { try { const raw = localStorage.getItem('aiHistory'); if (raw) renderHistory(JSON.parse(raw)) } catch { localStorage.removeItem('aiHistory') } }
        function saveToHistory(idea) { try { let h = JSON.parse(localStorage.getItem('aiHistory') || '[]'); h = h.filter(x => x.fullText !== idea); h.unshift({ title: idea.slice(0, 30) + '...', fullText: idea, date: new Date().toLocaleDateString() }); if (h.length > 5) h.pop(); localStorage.setItem('aiHistory', JSON.stringify(h)); renderHistory(h) } catch (e) { } }
        function renderHistory(h) { const l = document.getElementById('history-list'); if (!l) return; l.innerHTML = ''; h.forEach((x, i) => { const d = document.createElement('div'); d.className = "p-2 bg-gray-50 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 mb-2 flex justify-between cursor-pointer text-xs"; d.innerHTML = `<span class="truncate w-3/4 dark:text-gray-300">${x.title}</span><button onclick="del(${i},event)" class="text-red-400"><i class="fas fa-trash"></i></button>`; d.onclick = (e) => { if (!e.target.closest('button')) document.getElementById('idea-input').value = x.fullText || x.title }; l.appendChild(d) }) }
        window.del = (i, e) => { e.stopPropagation(); let h = JSON.parse(localStorage.getItem('aiHistory')); h.splice(i, 1); localStorage.setItem('aiHistory', JSON.stringify(h)); renderHistory(h) }; window.clearAllHistory = () => { localStorage.removeItem('aiHistory'); renderHistory([]) };
    </script>
</body>

</html>